<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="/static/css/unified-styles.css" rel="stylesheet">

    <style>
        .registration-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: var(--spacing-xl);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-lg);
            text-align: center;
        }

        .registration-icon {
            font-size: 64px;
            margin-bottom: var(--spacing-md);
        }

        .org-types {
            display: grid;
            gap: var(--spacing-sm);
            margin: var(--spacing-md) 0;
        }

        .type-option {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border: 2px solid var(--tg-theme-hint-color);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .type-option:hover {
            border-color: var(--tg-theme-button-color);
            background: rgba(38, 120, 182, 0.05);
        }

        .type-option.selected {
            border-color: var(--tg-theme-button-color);
            background: rgba(38, 120, 182, 0.1);
        }

        .type-icon {
            font-size: var(--font-size-xl);
            width: 40px;
            text-align: center;
        }

        .type-content {
            flex: 1;
        }

        .type-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .type-description {
            font-size: var(--font-size-sm);
            color: var(--tg-theme-hint-color);
        }

        .dynamic-fields {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-md) 0;
            border: 2px dashed var(--tg-theme-button-color);
        }

        .dynamic-fields h4 {
            color: var(--tg-theme-button-color);
            margin: 0 0 var(--spacing-md) 0;
        }

        .requirements-info {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid var(--color-warning);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .requirements-info h4 {
            margin: 0 0 var(--spacing-sm) 0;
            color: #856404;
            font-size: var(--font-size-sm);
        }

        .requirements-info ul {
            margin: 0;
            padding-left: var(--spacing-lg);
            font-size: var(--font-size-sm);
            color: #856404;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }

        .benefit-card {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            text-align: center;
        }

        .benefit-card-icon {
            font-size: 32px;
            margin-bottom: var(--spacing-sm);
        }

        .benefit-card-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .benefit-card-text {
            font-size: var(--font-size-sm);
            color: var(--tg-theme-hint-color);
        }

        @media (max-width: 480px) {
            .benefits-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="registration-header">
        <div class="registration-icon">üè¢</div>
        <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ –ø–æ–º–æ—â–Ω–∏–∫–æ–≤ –¥–ª—è –≤–∞—à–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</p>
    </div>

    <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->
    <div class="card">
        <div class="card-header">
            <h2>üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤</h2>
        </div>
        <div class="card-body">
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-card-icon">üë•</div>
                    <div class="benefit-card-title">–®–∏—Ä–æ–∫–∞—è –±–∞–∑–∞ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤</div>
                    <div class="benefit-card-text">–î–æ—Å—Ç—É–ø –∫ –∞–∫—Ç–∏–≤–Ω—ã–º –∏ –æ–ø—ã—Ç–Ω—ã–º –ø–æ–º–æ—â–Ω–∏–∫–∞–º</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-card-icon">‚ö°</div>
                    <div class="benefit-card-title">–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–±–æ—Ä</div>
                    <div class="benefit-card-text">–°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∏ –æ—Ç–∑—ã–≤–æ–≤</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-card-icon">üí∞</div>
                    <div class="benefit-card-title">–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞</div>
                    <div class="benefit-card-text">–ß–µ—Å—Ç–Ω—ã–µ —Ä–∞—Å—Ü–µ–Ω–∫–∏, –¥–æ–≤–æ–ª—å–Ω—ã–µ –ø–æ–º–æ—â–Ω–∏–∫–∏</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-card-icon">üì±</div>
                    <div class="benefit-card-title">–£–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                    <div class="benefit-card-text">–í—Å–µ –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <form id="registrationForm" class="card">
        <div class="card-header">
            <h2>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h2>
        </div>
        <div class="card-body">
            <div class="form-group">
                <label class="form-label required">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ / –§–ò–û</label>
                <input type="text" class="form-input" id="fullName" required
                       placeholder="–û–û–û '–ü—Ä–∏–º–µ—Ä' –∏–ª–∏ –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                <div class="form-help">–£–∫–∞–∂–∏—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –§–ò–û –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü</div>
            </div>

            <div class="form-group">
                <label class="form-label">–ì–æ—Ä–æ–¥</label>
                <input type="text" class="form-input" id="city"
                       placeholder="–í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è?" list="cityList">
                <datalist id="cityList">
                    <option value="–ú–æ—Å–∫–≤–∞">
                    <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">
                    <option value="–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫">
                    <option value="–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥">
                    <option value="–ö–∞–∑–∞–Ω—å">
                    <option value="–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥">
                    <option value="–ß–µ–ª—è–±–∏–Ω—Å–∫">
                    <option value="–û–º—Å–∫">
                    <option value="–°–∞–º–∞—Ä–∞">
                    <option value="–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É">
                </datalist>
            </div>

            <div class="form-group">
                <label class="form-label required">–¢–∏–ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</label>
                <div class="org-types">
                    <div class="type-option" data-type="—Ñ–∏–∑–ª–∏—Ü–æ">
                        <div class="type-icon">üë§</div>
                        <div class="type-content">
                            <div class="type-title">–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</div>
                            <div class="type-description">–ß–∞—Å—Ç–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ, —Å–µ–º–µ–π–Ω–æ–µ —Ç–æ—Ä–∂–µ—Å—Ç–≤–æ</div>
                        </div>
                    </div>
                    <div class="type-option" data-type="–ò–ü">
                        <div class="type-icon">üè™</div>
                        <div class="type-content">
                            <div class="type-title">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å</div>
                            <div class="type-description">–ò–ü, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ò–ù–ù</div>
                        </div>
                    </div>
                    <div class="type-option" data-type="–û–û–û">
                        <div class="type-icon">üè¢</div>
                        <div class="type-content">
                            <div class="type-title">–û–û–û</div>
                            <div class="type-description">–û–±—â–µ—Å—Ç–≤–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é</div>
                        </div>
                    </div>
                    <div class="type-option" data-type="–ù–ö–û">
                        <div class="type-icon">ü§ù</div>
                        <div class="type-content">
                            <div class="type-title">–ù–ö–û</div>
                            <div class="type-description">–ù–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</div>
                        </div>
                    </div>
                </div>
                <input type="hidden" id="orgType" required>
            </div>

            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è -->
            <div class="dynamic-fields" id="dynamicFields" style="display: none;">
                <h4 id="dynamicFieldsTitle">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h4>

                <div class="form-group" id="innField" style="display: none;">
                    <label class="form-label required">–ò–ù–ù</label>
                    <input type="text" class="form-input" id="inn"
                           placeholder="1234567890" maxlength="12">
                    <div class="form-help">10 —Ü–∏—Ñ—Ä –¥–ª—è –ò–ü, 12 –¥–ª—è –û–û–û</div>
                </div>

                <div class="form-group" id="orgNameField" style="display: none;">
                    <label class="form-label">–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</label>
                    <input type="text" class="form-input" id="orgName"
                           placeholder="–ü–æ–ª–Ω–æ–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</label>
                <textarea class="form-input" id="description" rows="4" maxlength="500"
                          placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:
‚Ä¢ –ö–∞–∫–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø—Ä–æ–≤–æ–¥–∏—Ç–µ
‚Ä¢ –°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚Ä¢ –û–ø—ã—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
                <div class="char-counter" id="descriptionCounter">0/500</div>
                <div class="form-help">–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤—ã—Å–∏—Ç –¥–æ–≤–µ—Ä–∏–µ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤</div>
            </div>

            <div class="requirements-info">
                <h4>üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h4>
                <ul>
                    <li>–£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</li>
                    <li>–ò–ü –∏ –û–û–û –¥–æ–ª–∂–Ω—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù</li>
                    <li>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–µ–≥–∞–ª—å–Ω—ã–º–∏</li>
                    <li>–°–æ–±–ª—é–¥–∞–π—Ç–µ —Ç—Ä—É–¥–æ–≤–æ–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–∏ –Ω–∞–π–º–µ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤</li>
                    <li>–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–ª–∞—á–∏–≤–∞–π—Ç–µ –æ–±–µ—â–∞–Ω–Ω–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</li>
                </ul>
            </div>
        </div>

        <div class="card-footer">
            <button type="submit" class="btn btn-primary btn-full">
                üöÄ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞
            </button>
        </div>
    </form>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
    <div class="card">
        <div class="card-header">
            <h3>üîç –ü—Ä–æ—Ü–µ—Å—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
        </div>
        <div class="card-body">
            <p>–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ:</p>
            <ul>
                <li>–°–æ–∑–¥–∞–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ –∏—Å–∫–∞—Ç—å –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤</li>
                <li>–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –∏ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</li>
                <li>–û–±—â–∞—Ç—å—Å—è —Å –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º–∏ —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã</li>
                <li>–û—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç–∑—ã–≤—ã –∏ —Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–ø—É—Ç–∞—Ü–∏—é</li>
            </ul>
            <p><small style="color: var(--tg-theme-hint-color);">
                –ú—ã –æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤.
            </small></p>
        </div>
    </div>

    <script src="/static/js/form-validator.js"></script>
    <script>
        class OrganizerRegistration {
            constructor() {
                this.selectedType = null;
                this.validationRules = {
                    inn: /^\d{10,12}$/
                };
            }

            async init() {
                console.log('üè¢ Initializing organizer registration...');

                await this.waitForApp();

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
                const alreadyRegistered = await this.checkExistingRegistration();
                if (alreadyRegistered) return;

                this.setupEventListeners();
                this.setupCharCounters();
                this.loadUserData();
            }

            async waitForApp() {
                return new Promise(resolve => {
                    if (window.app?.isReady) {
                        resolve();
                    } else {
                        window.addEventListener('app:ready', resolve);
                    }
                });
            }

            async checkExistingRegistration() {
                try {
                    const userData = await window.app.apiRequest('/api/auth/my-profile');
                    if (userData.registered) {
                        if (userData.user.role === 'organizer') {
                            window.location.href = '/organizer/profile';
                        } else {
                            window.location.href = '/';
                        }
                        return true;
                    }
                    return false;
                } catch (error) {
                    return false;
                }
            }

            setupEventListeners() {
                // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                document.querySelectorAll('.type-option').forEach(option => {
                    option.addEventListener('click', () => {
                        this.selectOrgType(option);
                    });
                });

                // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
                document.getElementById('registrationForm').addEventListener('submit', (e) => {
                    this.handleSubmit(e);
                });

                // –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                document.getElementById('inn').addEventListener('input', (e) => {
                    this.validateINN(e.target);
                });

                // –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ Telegram
                if (window.app?.tg?.MainButton) {
                    window.app.tg.MainButton.setText('üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é');
                    window.app.tg.MainButton.show();
                    window.app.tg.MainButton.onClick(() => {
                        window.location.href = '/';
                    });
                }
            }

            setupCharCounters() {
                const field = document.getElementById('description');
                const counter = document.getElementById('descriptionCounter');

                if (field && counter) {
                    field.addEventListener('input', () => {
                        const currentLength = field.value.length;
                        counter.textContent = `${currentLength}/500`;

                        counter.className = 'char-counter';
                        if (currentLength > 450) {
                            counter.classList.add('error');
                        } else if (currentLength > 350) {
                            counter.classList.add('warning');
                        }
                    });
                }
            }

            loadUserData() {
                if (window.app?.currentUser) {
                    const user = window.app.currentUser;
                    const fullNameField = document.getElementById('fullName');

                    if (fullNameField && user.first_name) {
                        const fullName = `${user.first_name} ${user.last_name || ''}`.trim();
                        fullNameField.value = fullName;
                    }
                }
            }

            selectOrgType(option) {
                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –æ–ø—Ü–∏–π
                document.querySelectorAll('.type-option').forEach(opt => {
                    opt.classList.remove('selected');
                });

                // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –æ–ø—Ü–∏—é
                option.classList.add('selected');

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä
                this.selectedType = option.dataset.type;
                document.getElementById('orgType').value = this.selectedType;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è
                this.updateDynamicFields();

                // –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                if (window.app?.tg?.HapticFeedback) {
                    window.app.tg.HapticFeedback.selectionChanged();
                }
            }

            updateDynamicFields() {
                const dynamicFields = document.getElementById('dynamicFields');
                const innField = document.getElementById('innField');
                const orgNameField = document.getElementById('orgNameField');
                const innInput = document.getElementById('inn');
                const titleElement = document.getElementById('dynamicFieldsTitle');

                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è
                innField.style.display = 'none';
                orgNameField.style.display = 'none';
                innInput.required = false;

                if (this.selectedType === '—Ñ–∏–∑–ª–∏—Ü–æ') {
                    dynamicFields.style.display = 'none';
                } else {
                    dynamicFields.style.display = 'block';

                    switch (this.selectedType) {
                        case '–ò–ü':
                            titleElement.textContent = '–î–∞–Ω–Ω—ã–µ –ò–ü';
                            innField.style.display = 'block';
                            innInput.required = true;
                            innInput.placeholder = '1234567890 (10 —Ü–∏—Ñ—Ä)';
                            break;
                        case '–û–û–û':
                            titleElement.textContent = '–î–∞–Ω–Ω—ã–µ –û–û–û';
                            innField.style.display = 'block';
                            orgNameField.style.display = 'block';
                            innInput.required = true;
                            innInput.placeholder = '123456789012 (12 —Ü–∏—Ñ—Ä)';
                            break;
                        case '–ù–ö–û':
                            titleElement.textContent = '–î–∞–Ω–Ω—ã–µ –ù–ö–û';
                            orgNameField.style.display = 'block';
                            break;
                    }
                }
            }

            validateINN(input) {
                const value = input.value.replace(/\D/g, ''); // –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
                input.value = value;

                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
                input.classList.remove('error');
                const errorMsg = input.parentNode.querySelector('.form-error');
                if (errorMsg) errorMsg.remove();

                if (value && !this.validationRules.inn.test(value)) {
                    input.classList.add('error');
                    const error = document.createElement('div');
                    error.className = 'form-error';
                    error.textContent = '–ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10-12 —Ü–∏—Ñ—Ä';
                    input.parentNode.appendChild(error);
                }
            }

            async handleSubmit(e) {
                e.preventDefault();

                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;

                try {
                    submitBtn.disabled = true;
                    submitBtn.textContent = '‚è≥ –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å...';

                    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                    const formData = {
                        full_name: document.getElementById('fullName').value.trim(),
                        city: document.getElementById('city').value.trim(),
                        org_type: this.selectedType,
                        org_name: document.getElementById('orgName').value.trim(),
                        inn: document.getElementById('inn').value.trim(),
                        description: document.getElementById('description').value.trim()
                    };

                    // –í–∞–ª–∏–¥–∞—Ü–∏—è
                    const validation = this.validateForm(formData);
                    if (!validation.isValid) {
                        window.app.showError(validation.errors.join('\n'));
                        return;
                    }

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    const response = await window.app.apiRequest('/api/organizers/register', {
                        method: 'POST',
                        body: JSON.stringify(formData)
                    });

                    console.log('‚úÖ Registration successful:', response);

                    window.app.showSuccess('–ü—Ä–æ—Ñ–∏–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');

                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å
                    setTimeout(() => {
                        window.location.href = '/organizer/profile';
                    }, 1500);

                } catch (error) {
                    console.error('‚ùå Registration failed:', error);
                    window.app.showError('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            }

            validateForm(formData) {
                const errors = [];

                if (!formData.full_name) {
                    errors.push('–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –§–ò–û');
                }

                if (!formData.org_type) {
                    errors.push('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏');
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ò–ù–ù –¥–ª—è –ò–ü –∏ –û–û–û
                if (['–ò–ü', '–û–û–û'].includes(formData.org_type)) {
                    if (!formData.inn) {
                        errors.push('–ò–ù–ù –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –ò–ü –∏ –û–û–û');
                    } else if (!this.validationRules.inn.test(formData.inn)) {
                        errors.push('–ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10-12 —Ü–∏—Ñ—Ä');
                    } else if (formData.org_type === '–ò–ü' && formData.inn.length !== 10) {
                        errors.push('–ò–ù–ù –¥–ª—è –ò–ü –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 —Ü–∏—Ñ—Ä');
                    } else if (formData.org_type === '–û–û–û' && formData.inn.length !== 12) {
                        errors.push('–ò–ù–ù –¥–ª—è –û–û–û –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 12 —Ü–∏—Ñ—Ä');
                    }
                }

                if (formData.full_name && formData.full_name.length < 2) {
                    errors.push('–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                }

                if (formData.description && formData.description.length > 500) {
                    errors.push('–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ');
                }

                return {
                    isValid: errors.length === 0,
                    errors
                };
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const registration = new OrganizerRegistration();
        document.addEventListener('DOMContentLoaded', () => {
            registration.init();
        });
    </script>
</body>
</html>