<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="/static/css/unified-styles.css" rel="stylesheet">

    <style>
        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è */
        .form-wizard {
            position: relative;
        }

        .wizard-progress {
            display: flex;
            justify-content: center;
            margin-bottom: var(--spacing-xl);
            position: relative;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
            max-width: 120px;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 60%;
            right: -40%;
            height: 2px;
            background: var(--tg-theme-hint-color);
            z-index: 1;
        }

        .progress-step.completed::after {
            background: var(--color-success);
        }

        .step-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--tg-theme-hint-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            position: relative;
            z-index: 2;
            transition: all var(--transition-fast);
        }

        .progress-step.active .step-indicator {
            background: var(--tg-theme-button-color);
            transform: scale(1.1);
        }

        .progress-step.completed .step-indicator {
            background: var(--color-success);
        }

        .step-label {
            font-size: var(--font-size-xs);
            color: var(--tg-theme-hint-color);
            text-align: center;
            line-height: 1.2;
        }

        .progress-step.active .step-label {
            color: var(--tg-theme-text-color);
            font-weight: 500;
        }

        .wizard-step {
            display: none;
            animation: slideIn 0.3s ease;
        }

        .wizard-step.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .form-section {
            margin-bottom: var(--spacing-xl);
        }

        .section-title {
            font-size: var(--font-size-md);
            font-weight: 600;
            color: var(--tg-theme-text-color);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .form-grid.single {
            grid-template-columns: 1fr;
        }

        .char-counter {
            font-size: var(--font-size-xs);
            color: var(--tg-theme-hint-color);
            text-align: right;
            margin-top: var(--spacing-xs);
        }

        .char-counter.warning {
            color: var(--color-warning);
        }

        .char-counter.error {
            color: var(--color-danger);
        }

        .form-preview {
            background: var(--tg-theme-secondary-bg-color);
            border: 2px dashed var(--tg-theme-hint-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }

        .preview-title {
            font-size: var(--font-size-md);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--tg-theme-text-color);
        }

        .preview-content {
            font-size: var(--font-size-sm);
            color: var(--tg-theme-hint-color);
            line-height: 1.4;
        }

        .wizard-navigation {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--tg-theme-hint-color);
        }

        .btn-wizard {
            flex: 1;
        }

        .requirements-list {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid var(--color-warning);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .requirements-list h4 {
            margin: 0 0 var(--spacing-sm) 0;
            color: #856404;
            font-size: var(--font-size-sm);
        }

        .requirements-list ul {
            margin: 0;
            padding-left: var(--spacing-lg);
            font-size: var(--font-size-sm);
            color: #856404;
        }

        .quick-preset {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
            margin-bottom: var(--spacing-md);
        }

        .preset-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--tg-theme-hint-color);
            border-radius: var(--radius-md);
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-size: var(--font-size-xs);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .preset-btn:hover {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border-color: var(--tg-theme-button-color);
        }

        .form-tips {
            background: rgba(23, 162, 184, 0.1);
            border-left: 4px solid var(--color-info);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
        }

        .form-tips h4 {
            margin: 0 0 var(--spacing-xs) 0;
            color: var(--color-info);
            font-size: var(--font-size-sm);
        }

        .form-tips p {
            margin: 0;
            font-size: var(--font-size-sm);
            color: var(--tg-theme-hint-color);
        }

        @media (max-width: 480px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .wizard-progress {
                margin-bottom: var(--spacing-lg);
            }

            .progress-step {
                max-width: 80px;
            }

            .step-indicator {
                width: 32px;
                height: 32px;
                font-size: var(--font-size-xs);
            }

            .step-label {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="page-header">
        <h1 class="page-title">‚ûï –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h1>
        <p class="page-subtitle">–ù–∞–π–¥–∏—Ç–µ –ø–æ–º–æ—â–Ω–∏–∫–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–æ–±—ã—Ç–∏—è</p>
    </div>

    <form id="eventForm" class="form-wizard">
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
        <div class="wizard-progress">
            <div class="progress-step active" data-step="1">
                <div class="step-indicator">1</div>
                <div class="step-label">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-indicator">2</div>
                <div class="step-label">–î–µ—Ç–∞–ª–∏</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-indicator">3</div>
                <div class="step-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-indicator">‚úì</div>
                <div class="step-label">–ì–æ—Ç–æ–≤–æ</div>
            </div>
        </div>

        <!-- –®–∞–≥ 1: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="wizard-step active" data-step="1">
            <div class="card">
                <div class="card-header">
                    <h2 class="section-title">üìù –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                </div>
                <div class="card-body">
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label required">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</label>
                            <input type="text" class="form-input" id="eventTitle" required
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–º–æ—â—å –Ω–∞ –≤—ã—Å—Ç–∞–≤–∫–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π" maxlength="100">
                            <div class="char-counter" id="titleCounter">0/100</div>
                            <div class="form-help">–ö—Ä–∞—Ç–∫–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏–≤–ª–µ—á–µ—Ç –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤</div>
                        </div>

                        <div class="form-tips">
                            <h4>üí° –°–æ–≤–µ—Ç—ã –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è</h4>
                            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–ª–æ–≤–∞: "–ø–æ–º–æ—â—å –Ω–∞ –≤—ã—Å—Ç–∞–≤–∫–µ" –≤–º–µ—Å—Ç–æ "–Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å". –£–∫–∞–∂–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –∏ –∑–∞–¥–∞—á–∏.</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">–¢–∏–ø —Ä–∞–±–æ—Ç—ã</label>
                            <select class="form-input" id="workType" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã</option>
                                <option value="—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</option>
                                <option value="–ª–æ–≥–∏—Å—Ç–∏–∫–∞">üì¶ –õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è</option>
                                <option value="—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ">üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</option>
                                <option value="–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ">üí¨ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</option>
                                <option value="–ø—Ä–æ–º–æ">üì¢ –ü—Ä–æ–º–æ –∏ —Ä–µ–∫–ª–∞–º–∞</option>
                                <option value="–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ">üçΩÔ∏è –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –≥–æ—Å—Ç–µ–π</option>
                                <option value="–¥—Ä—É–≥–æ–µ">üîπ –î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">–ì–æ—Ä–æ–¥</label>
                                <input type="text" class="form-input" id="eventCity" required
                                       placeholder="–ú–æ—Å–∫–≤–∞" list="cityList">
                                <datalist id="cityList">
                                    <option value="–ú–æ—Å–∫–≤–∞">
                                    <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">
                                    <option value="–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫">
                                    <option value="–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥">
                                    <option value="–ö–∞–∑–∞–Ω—å">
                                    <option value="–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥">
                                </datalist>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">–û–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
                                <input type="number" class="form-input" id="eventPayment" required
                                       min="0" step="100" placeholder="1000">
                                <div class="form-help">–£–∫–∞–∑—ã–≤–∞–π—Ç–µ —á–µ—Å—Ç–Ω—É—é –æ–ø–ª–∞—Ç—É - —ç—Ç–æ –≥–ª–∞–≤–Ω—ã–π –º–æ—Ç–∏–≤–∞—Ç–æ—Ä</div>
                            </div>
                        </div>

                        <div class="quick-preset">
                            <span style="font-size: var(--font-size-sm); color: var(--tg-theme-hint-color);">–ë—ã—Å—Ç—Ä—ã–µ —Å—É–º–º—ã:</span>
                            <button type="button" class="preset-btn" data-payment="500">500‚ÇΩ</button>
                            <button type="button" class="preset-btn" data-payment="1000">1000‚ÇΩ</button>
                            <button type="button" class="preset-btn" data-payment="1500">1500‚ÇΩ</button>
                            <button type="button" class="preset-btn" data-payment="2000">2000‚ÇΩ</button>
                            <button type="button" class="preset-btn" data-payment="3000">3000‚ÇΩ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 2: –î–µ—Ç–∞–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
        <div class="wizard-step" data-step="2">
            <div class="card">
                <div class="card-header">
                    <h2 class="section-title">‚è∞ –í—Ä–µ–º—è –∏ –æ–ø–∏—Å–∞–Ω–∏–µ</h2>
                </div>
                <div class="card-body">
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
                                <input type="datetime-local" class="form-input" id="eventDate">
                                <div class="form-help">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –¥–∞—Ç–∞ –≥–∏–±–∫–∞—è</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å–æ–≤)</label>
                                <input type="number" class="form-input" id="eventDuration"
                                       min="1" max="24" placeholder="8">
                                <div class="form-help">–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</label>
                            <textarea class="form-input" id="eventDescription" rows="5" maxlength="1000"
                                      placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ:
‚Ä¢ –ß—Ç–æ –∑–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
‚Ä¢ –ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç —É –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤
‚Ä¢ –ö–∞–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è
‚Ä¢ –£—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã –∏ –ª—å–≥–æ—Ç—ã"></textarea>
                            <div class="char-counter" id="descriptionCounter">0/1000</div>
                            <div class="form-help">–ß–µ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–º –±–æ–ª—å—à–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–∫–ª–∏–∫–æ–≤</div>
                        </div>

                        <div class="form-tips">
                            <h4>üí° –ß—Ç–æ –≤–∫–ª—é—á–∏—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–µ</h4>
                            <p>–û–ø–∏—à–∏—Ç–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —Å–æ–±—ã—Ç–∏—è, –∫–∞–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –Ω—É–∂–Ω—ã, —á—Ç–æ –≤–æ–ª–æ–Ω—Ç—ë—Ä –ø–æ–ª—É—á–∏—Ç –∫—Ä–æ–º–µ –æ–ø–ª–∞—Ç—ã (–æ–ø—ã—Ç, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –ø–∏—Ç–∞–Ω–∏–µ).</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</label>
                            <textarea class="form-input" id="eventRequirements" rows="3" maxlength="500"
                                      placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
‚Ä¢ –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –ª—é–¥—å–º–∏
‚Ä¢ –ó–Ω–∞–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
‚Ä¢ –î—Ä–µ—Å—Å-–∫–æ–¥: –¥–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å
‚Ä¢ –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"></textarea>
                            <div class="char-counter" id="requirementsCounter">0/500</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 3: –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
        <div class="wizard-step" data-step="3">
            <div class="card">
                <div class="card-header">
                    <h2 class="section-title">üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                </div>
                <div class="card-body">
                    <div class="form-section">
                        <div class="requirements-list">
                            <h4>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</h4>
                            <ul>
                                <li>–ö–æ–Ω—Ç–∞–∫—Ç—ã –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–º –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º</li>
                                <li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É–∫–∞–∑–∞—Ç—å —Ä–∞–±–æ—á–∏–π –Ω–æ–º–µ—Ä –∏–ª–∏ Telegram</li>
                                <li>–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏</li>
                            </ul>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏ —Å –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º–∏</label>
                            <textarea class="form-input" id="eventContact" rows="3" maxlength="300"
                                      placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
üì± +7 (999) 123-45-67 (WhatsApp)
üìß events@company.ru
üí¨ @username (Telegram)

–ó–≤–æ–Ω–∏—Ç—å —Å 9:00 –¥–æ 18:00"></textarea>
                            <div class="char-counter" id="contactCounter">0/300</div>
                            <div class="form-help">–£–∫–∞–∂–∏—Ç–µ —É–¥–æ–±–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–≤—è–∑–∏ –∏ –≤—Ä–µ–º—è –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–∞</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ê–¥—Ä–µ—Å –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)</label>
                            <input type="text" class="form-input" id="eventAddress"
                                   placeholder="—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123, –ë–¶ '–ü—Ä–∏–º–µ—Ä', 5 —ç—Ç–∞–∂">
                            <div class="form-help">–¢–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –±—É–¥–µ—Ç –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–º –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 4: –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Å–æ–∑–¥–∞–Ω–∏–µ -->
        <div class="wizard-step" data-step="4">
            <div class="card">
                <div class="card-header">
                    <h2 class="section-title">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
                </div>
                <div class="card-body">
                    <div class="form-preview" id="eventPreview">
                        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
                    </div>

                    <div class="form-tips">
                        <h4>üöÄ –ì–æ—Ç–æ–≤—ã –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏?</h4>
                        <p>–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å—Ç–∞–Ω–µ—Ç –≤–∏–¥–Ω–æ –≤—Å–µ–º –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º. –í—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –∏ –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–º -->
        <div class="wizard-navigation">
            <button type="button" class="btn btn-secondary btn-wizard" id="prevBtn" style="display: none;">
                ‚Üê –ù–∞–∑–∞–¥
            </button>
            <button type="button" class="btn btn-primary btn-wizard" id="nextBtn">
                –î–∞–ª–µ–µ ‚Üí
            </button>
            <button type="submit" class="btn btn-success btn-wizard" id="submitBtn" style="display: none;">
                üöÄ –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
            </button>
        </div>
    </form>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="bottom-nav">
        <a href="/organizer/profile" class="nav-item">
            <span class="nav-icon">üë§</span>
            <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
        <a href="/organizer/create-event" class="nav-item active">
            <span class="nav-icon">‚ûï</span>
            <span class="nav-label">–°–æ–∑–¥–∞—Ç—å</span>
        </a>
        <a href="/organizer/events" class="nav-item">
            <span class="nav-icon">üìã</span>
            <span class="nav-label">–°–æ–±—ã—Ç–∏—è</span>
        </a>
    </nav>

    <script src="/static/js/form-validator.js"></script>
    <script src="/static/js/navigation.js"></script>
    <script>
        class EventCreationWizard {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 4;
                this.formData = {};
                this.validator = window.formValidator;

                this.validationSchema = {
                    eventTitle: ['required', { type: 'maxLength', value: 100 }],
                    workType: ['required'],
                    eventCity: ['required'],
                    eventPayment: ['required', 'positiveNumber']
                };
            }

            async init() {
                console.log('üìù Initializing event creation wizard...');

                await this.waitForApp();

                const roleCheck = await this.checkUserRole();
                if (!roleCheck) return;

                this.setupEventListeners();
                this.setupCharCounters();
                this.setupPresets();
                this.updatePreview();
                this.loadUserData();
            }

            async waitForApp() {
                return new Promise(resolve => {
                    if (window.app?.isReady) {
                        resolve();
                    } else {
                        window.addEventListener('app:ready', resolve);
                    }
                });
            }

            async checkUserRole() {
                try {
                    const userData = await window.app.apiRequest('/api/auth/my-profile');
                    if (!userData.registered || userData.user.role !== 'organizer') {
                        window.location.href = '/';
                        return false;
                    }
                    return true;
                } catch (error) {
                    console.error('Role check failed:', error);
                    window.location.href = '/';
                    return false;
                }
            }

            setupEventListeners() {
                // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                document.getElementById('nextBtn').addEventListener('click', () => this.nextStep());
                document.getElementById('prevBtn').addEventListener('click', () => this.prevStep());
                document.getElementById('eventForm').addEventListener('submit', (e) => this.handleSubmit(e));

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
                const watchFields = ['eventTitle', 'eventDescription', 'eventCity', 'eventPayment', 'workType', 'eventDate', 'eventDuration'];
                watchFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', () => this.updatePreview());
                    }
                });
            }

            setupCharCounters() {
                const counters = [
                    { fieldId: 'eventTitle', counterId: 'titleCounter', maxLength: 100 },
                    { fieldId: 'eventDescription', counterId: 'descriptionCounter', maxLength: 1000 },
                    { fieldId: 'eventRequirements', counterId: 'requirementsCounter', maxLength: 500 },
                    { fieldId: 'eventContact', counterId: 'contactCounter', maxLength: 300 }
                ];

                counters.forEach(({ fieldId, counterId, maxLength }) => {
                    const field = document.getElementById(fieldId);
                    const counter = document.getElementById(counterId);

                    if (field && counter) {
                        field.addEventListener('input', () => {
                            const currentLength = field.value.length;
                            counter.textContent = `${currentLength}/${maxLength}`;

                            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏
                            counter.className = 'char-counter';
                            if (currentLength > maxLength * 0.9) {
                                counter.classList.add('error');
                            } else if (currentLength > maxLength * 0.7) {
                                counter.classList.add('warning');
                            }
                        });
                    }
                });
            }

            setupPresets() {
                // –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É–º–º—ã
                document.querySelectorAll('.preset-btn[data-payment]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const payment = btn.dataset.payment;
                        document.getElementById('eventPayment').value = payment;
                        this.updatePreview();
                    });
                });

                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π
                const dateField = document.getElementById('eventDate');
                if (dateField) {
                    const now = new Date();
                    const minDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
                    dateField.min = minDateTime;
                }
            }

            async loadUserData() {
                try {
                    const userData = await window.app.apiRequest('/api/auth/my-profile');
                    if (userData.registered && userData.user.city) {
                        document.getElementById('eventCity').value = userData.user.city;
                        this.updatePreview();
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
            }

            nextStep() {
                if (this.validateCurrentStep()) {
                    if (this.currentStep < this.totalSteps) {
                        this.currentStep++;
                        this.updateStepDisplay();
                        this.updatePreview();
                    }
                }
            }

            prevStep() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.updateStepDisplay();
                }
            }

            validateCurrentStep() {
                if (this.currentStep === 1) {
                    const formData = {
                        eventTitle: document.getElementById('eventTitle').value,
                        workType: document.getElementById('workType').value,
                        eventCity: document.getElementById('eventCity').value,
                        eventPayment: document.getElementById('eventPayment').value
                    };

                    const validation = this.validator.validateForm(formData, this.validationSchema);

                    if (!validation.isValid) {
                        this.validator.displayErrors(validation.errors);
                        return false;
                    } else {
                        this.validator.clearErrors();
                        return true;
                    }
                }

                return true; // –û—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–æ–∫–∞ –±–µ–∑ –∂–µ—Å—Ç–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            }

            updateStepDisplay() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                document.querySelectorAll('.progress-step').forEach((step, index) => {
                    const stepNum = index + 1;
                    step.classList.remove('active', 'completed');

                    if (stepNum < this.currentStep) {
                        step.classList.add('completed');
                    } else if (stepNum === this.currentStep) {
                        step.classList.add('active');
                    }
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —à–∞–≥–∏
                document.querySelectorAll('.wizard-step').forEach((step, index) => {
                    const stepNum = index + 1;
                    step.classList.toggle('active', stepNum === this.currentStep);
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');

                prevBtn.style.display = this.currentStep > 1 ? 'block' : 'none';

                if (this.currentStep === this.totalSteps) {
                    nextBtn.style.display = 'none';
                    submitBtn.style.display = 'block';
                } else {
                    nextBtn.style.display = 'block';
                    submitBtn.style.display = 'none';
                }

                // –°–∫—Ä–æ–ª–ª–∏–º –Ω–∞–≤–µ—Ä—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ —à–∞–≥–∞
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            updatePreview() {
                if (this.currentStep !== 4) return;

                const formData = this.collectFormData();
                const preview = document.getElementById('eventPreview');

                if (!preview) return;

                const paymentFormatted = formData.eventPayment ?
                    new Intl.NumberFormat('ru-RU').format(formData.eventPayment) + ' ‚ÇΩ' : '–ù–µ —É–∫–∞–∑–∞–Ω–∞';

                const dateFormatted = formData.eventDate ?
                    new Date(formData.eventDate).toLocaleDateString('ru-RU', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : '–ì–∏–±–∫–∞—è –¥–∞—Ç–∞';

                preview.innerHTML = `
                    <div class="preview-title">${formData.eventTitle || '–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è'}</div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin: var(--spacing-md) 0;">
                        <div style="font-size: var(--font-size-xl); font-weight: 700; color: var(--color-success);">
                            ${paymentFormatted}
                        </div>
                        <div class="badge badge-active">üü¢ –ê–∫—Ç–∏–≤–Ω–æ</div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--spacing-sm); margin: var(--spacing-md) 0;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: var(--font-size-sm);">
                            <span>üìç</span> ${formData.eventCity || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: var(--font-size-sm);">
                            <span>üìÖ</span> ${dateFormatted}
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: var(--font-size-sm);">
                            <span>‚è∞</span> ${formData.eventDuration ? formData.eventDuration + ' —á' : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-xs); font-size: var(--font-size-sm);">
                            <span>üè∑Ô∏è</span> ${formData.workType || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                        </div>
                    </div>

                    ${formData.eventDescription ? `
                        <div style="margin: var(--spacing-md) 0;">
                            <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>
                            <div style="white-space: pre-wrap; margin-top: var(--spacing-xs);">${formData.eventDescription}</div>
                        </div>
                    ` : ''}

                    ${formData.eventRequirements ? `
                        <div style="margin: var(--spacing-md) 0;">
                            <strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong><br>
                            <div style="white-space: pre-wrap; margin-top: var(--spacing-xs);">${formData.eventRequirements}</div>
                        </div>
                    ` : ''}
                `;
            }

            collectFormData() {
                return {
                    eventTitle: document.getElementById('eventTitle').value.trim(),
                    workType: document.getElementById('workType').value,
                    eventCity: document.getElementById('eventCity').value.trim(),
                    eventPayment: parseFloat(document.getElementById('eventPayment').value) || 0,
                    eventDate: document.getElementById('eventDate').value || null,
                    eventDuration: parseInt(document.getElementById('eventDuration').value) || null,
                    eventDescription: document.getElementById('eventDescription').value.trim(),
                    eventRequirements: document.getElementById('eventRequirements').value.trim(),
                    eventContact: document.getElementById('eventContact').value.trim(),
                    eventAddress: document.getElementById('eventAddress').value.trim()
                };
            }

            buildFullDescription() {
                const formData = this.collectFormData();
                let description = formData.eventDescription;

                if (formData.eventRequirements) {
                    description += '\n\nüìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:\n' + formData.eventRequirements;
                }

                if (formData.eventContact) {
                    description += '\n\nüìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:\n' + formData.eventContact;
                }

                if (formData.eventAddress) {
                    description += '\n\nüìç –ê–¥—Ä–µ—Å:\n' + formData.eventAddress;
                }

                return description;
            }

            async handleSubmit(e) {
                e.preventDefault();

                const submitBtn = document.getElementById('submitBtn');
                const originalText = submitBtn.textContent;

                try {
                    submitBtn.disabled = true;
                    submitBtn.textContent = '‚è≥ –°–æ–∑–¥–∞—ë–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ...';

                    const formData = this.collectFormData();

                    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                    const validation = this.validator.validateForm(formData, this.validationSchema);
                    if (!validation.isValid) {
                        this.currentStep = 1;
                        this.updateStepDisplay();
                        this.validator.displayErrors(validation.errors);
                        return;
                    }

                    const eventData = {
                        title: formData.eventTitle,
                        description: this.buildFullDescription(),
                        city: formData.eventCity,
                        payment: formData.eventPayment,
                        date: formData.eventDate,
                        duration: formData.eventDuration,
                        work_type: formData.workType
                    };

                    console.log('üìä Submitting event data:', eventData);

                    const response = await window.app.apiRequest('/api/events/', {
                        method: 'POST',
                        body: JSON.stringify(eventData)
                    });

                    console.log('‚úÖ Event created successfully:', response);

                    window.app.showSuccess('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ!');

                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏
                    setTimeout(() => {
                        window.location.href = '/organizer/events';
                    }, 1500);

                } catch (error) {
                    console.error('‚ùå Event creation failed:', error);
                    window.app.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: ' + error.message);

                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞
        const wizard = new EventCreationWizard();
        document.addEventListener('DOMContentLoaded', () => {
            wizard.init();
        });
    </script>
</body>
</html>